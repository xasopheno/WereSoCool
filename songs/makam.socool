-- needs makam!

{ f: 220, l: 0.2, g: 1.0, p: 0.0}

et12semitone = { Tm 1.05946 }
et12semitonedown = { Tm 0.943878 }
et12tone = { et12semitone | et12semitone }

majorScale = {
  Sequence[
    AsIs,
    et12tone,
    et12tone | et12tone,
    et12tone | et12tone | et12semitone,
    et12tone | et12tone | et12semitone | et12tone,
    et12tone | et12tone | et12semitone | et12tone | et12tone,
    et12tone | et12tone | et12semitone | et12tone | et12tone | et12tone,
    et12tone | et12tone | et12semitone | et12tone | et12tone | et12tone | et12semitone
  ]
}

et12_c  = { AsIs }
et12_cS = { et12_c | et12semitone }
et12_d  = { et12_cS | et12semitone }
et12_dS = { et12_d | et12semitone }
et12_e  = { et12_dS | et12semitone }
et12_f  = { et12_e | et12semitone }
et12_fS = { et12_f | et12semitone }
et12_g  = { et12_fS | et12semitone }
et12_gS = { et12_g | et12semitone }
et12_a  = { et12_gS | et12semitone }
et12_aS = { et12_a | et12semitone }
et12_b  = { et12_aS | et12semitone }
et12_C  = { et12_b | et12semitone }

et24qtone = { Tm 1.0293 }
et24qtonedown = { Tm 0.97153 }

bayati_d   = { et12_d }
bayati_eHF = { et12_e | et24qtonedown }
bayati_f   = { et12_f }
bayati_g   = { et12_g }
bayati_a   = { et12_a }
bayati_bF  = { et12_b | et12semitonedown }
bayati_C   = { et12_C }
bayati_D   = { et12_d | Tm 2.0 }

bya = { bayati_d }
bys = { bayati_eHF }
byd = { bayati_f }
byf = { bayati_g }
byg = { bayati_a }
byh = { bayati_bF }
byj = { bayati_C }
byk = { bayati_D }

bayati_melody = { Sequence[ bya, byj, byh, byf, byg, byg, bya ] }

instrument = { Sequence[
                 Overlay[
                   AsIs,
                   Tm 3 | Gain 0.4,
                 ],
                 Overlay[
                   AsIs,
                   Tm 5 | Gain 0.9,
                 ],
                 Overlay[
                   AsIs,
                   Tm 2/3 | Gain 0.1,
                   Tm 4/5 | Gain 0.08,
                   Tm 6/7 | Gain 0.06,
                   Tm 10/11 | Gain 0.05,
                   Tm 12/13 | Gain 0.03,
                   Tm 16/17 | Gain 0.02,
                   Tm 22/23 | Gain 0.02
                 ]
              ] }

input = { (bayati_melody | Repeat 7) > ModulateBy instrument }

main = {
  input
}
